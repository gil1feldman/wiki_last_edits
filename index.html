<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>注专转 专转 拽驻</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      margin: 20px;
    }

    .filters {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filters input {
      flex: 1;
      padding: 8px;
      font-size: 16px;
      min-width: 250px;
    }

    .summaries {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }

    .summary-box {
      flex: 1;
      min-width: 300px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: right;
    }

    th {
      background-color: #f2f2f2;
    }

    a {
      color: #0645ad;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <h1>注专转 专转 拽驻</h1>

  <!-- 砖转 住 -->
  <div class="filters">
    <input type="text" id="editorFilter" onkeyup="filterTable()" placeholder=" 住 驻 砖 注专">
    <input type="text" id="pageFilter" onkeyup="filterTable()" placeholder=" 住 驻 砖 注专">
  </div>

  <!-- 转 住 -->
  <div class="summaries">
    <!-- 转 注专 -->
    <div class="summary-box">
      <h2>10 注专 注  专 注专转</h2>
      <table id="summaryTable">
        <thead>
          <tr>
            <th>砖 注专</th>
            <th>住驻专</th>
            <th> 专</th>
            <th>拽砖专</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- 转 注专 -->
    <div class="summary-box">
      <h2>10 注专 驻注 转专</h2>
      <table id="editorsTable">
        <thead>
          <tr>
            <th>砖 注专</th>
            <th>住驻专 注专转</th>
            <th>拽砖专</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- 转 注专转 -->
  <table id="editsTable">
    <thead>
      <tr>
        <th>砖 注专</th>
        <th> 注专</th>
        <th>注专转</th>
        <th> 砖</th>
        <th>拽砖专 </th>
        <th>拽砖专 注专</th>
        <th>砖 注专</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let allEdits = [];

    async function fetchRecentChanges() {
      const url = 'https://he.wikipedia.org/w/api.php?action=query&format=json&list=recentchanges&rcnamespace=0&rclimit=100&rcprop=title|ids|sizes|user|comment|timestamp&origin=*';
      const response = await fetch(url);
      const data = await response.json();
      return data.query.recentchanges;
    }

    function populateEditsTable(edits) {
      const tableBody = document.querySelector('#editsTable tbody');
      tableBody.innerHTML = '';

      edits.forEach(edit => {
        const row = document.createElement('tr');
        const sizeChange = (edit.newlen ?? 0) - (edit.oldlen ?? 0);
        row.innerHTML = `
          <td>${edit.title}</td>
          <td>${new Date(edit.timestamp).toLocaleString('he-IL')}</td>
          <td>${edit.comment || ''}</td>
          <td>${sizeChange > 0 ? '+' : ''}${sizeChange}</td>
          <td><a href="https://he.wikipedia.org/w/index.php?diff=${edit.revid}" target="_blank"></a></td>
          <td><a href="https://he.wikipedia.org/wiki/${encodeURIComponent(edit.title)}" target="_blank">爪驻</a></td>
          <td><a href="https://he.wikipedia.org/wiki/User:${encodeURIComponent(edit.user)}" target="_blank">${edit.user}</a></td>
        `;
        tableBody.appendChild(row);
      });

      updateSummaryTables(edits);
    }

    function filterTable() {
      const editorInput = document.getElementById('editorFilter').value.toLowerCase();
      const pageInput = document.getElementById('pageFilter').value.toLowerCase();
      const rows = document.querySelectorAll('#editsTable tbody tr');

      rows.forEach(row => {
        const editor = row.cells[6].textContent.toLowerCase();
        const page = row.cells[0].textContent.toLowerCase();

        if (editor.includes(editorInput) && page.includes(pageInput)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });

      const filtered = allEdits.filter(edit =>
        edit.user.toLowerCase().includes(editorInput) &&
        edit.title.toLowerCase().includes(pageInput)
      );

      updateSummaryTables(filtered);
    }

    function updateSummaryTables(edits) {
      // 住 驻 注专
      const pages = {};
      edits.forEach(edit => {
        const title = edit.title;
        const time = edit.timestamp;
        if (!pages[title]) pages[title] = { count: 0, latest: time };
        pages[title].count++;
        if (new Date(time) > new Date(pages[title].latest)) {
          pages[title].latest = time;
        }
      });

      const topPages = Object.entries(pages)
        .sort((a, b) => b[1].count - a[1].count)
        .slice(0, 10);

      const summaryBody = document.querySelector('#summaryTable tbody');
      summaryBody.innerHTML = '';
      topPages.forEach(([title, data]) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${title}</td>
          <td>${data.count}</td>
          <td>${new Date(data.latest).toLocaleString('he-IL')}</td>
          <td><a href="https://he.wikipedia.org/wiki/${encodeURIComponent(title)}" target="_blank">爪驻</a></td>
        `;
        summaryBody.appendChild(row);
      });

      // 住 驻 注专
      const editors = {};
      edits.forEach(edit => {
        const user = edit.user;
        if (!editors[user]) editors[user] = 0;
        editors[user]++;
      });

      const topEditors = Object.entries(editors)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);

      const editorsBody = document.querySelector('#editorsTable tbody');
      editorsBody.innerHTML = '';
      topEditors.forEach(([user, count]) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user}</td>
          <td>${count}</td>
          <td><a href="https://he.wikipedia.org/wiki/User:${encodeURIComponent(user)}" target="_blank">驻专驻</a></td>
        `;
        editorsBody.appendChild(row);
      });
    }

    async function init() {
      allEdits = await fetchRecentChanges();
      populateEditsTable(allEdits);
    }

    init();
    setInterval(init, 30000);
  </script>

</body>
</html>
